<!DOCTYPE html>

<html>

<head>
  <meta name="viewport" content="width=600"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"> 
  <style>
    body {
      width: 600px;
      margin: 0 auto;
      font-family: 'Open Sans', sans-serif;
      background-color: #151718;
      color: white;
      padding-bottom: 100px;
    }
    .panel {
      margin-top: 10px;
      margin-bottom: 10px;
      background-color: #363e4a;
      border-radius: 3px;
      color: #edeff3;
      font-size: 14px;
    }
    .line {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }
    .slider {
      padding: 6px;
    }
    button {
      height: 2em;
      background-color: #0000004b;
      border: none;
      margin: 6px;
      border-radius: 2px;
      font-family: 'Open Sans', sans-serif;
      font-size: 12px;
      color: #edeff3;
      padding: 4px;
      padding-left: 6px;
      padding-right: 6px;
    }
    #description {
      margin-top: 0px;
      margin-bottom: 30px;
    }
    #explanations {
      margin-top: 35px;
    }
    h1 {
      margin-top: 30px;
      margin-bottom: 10px;
      font-weight: 700;
      font-size: 28px;
    }
    input {
      background-color: #0000006c;
      color: #edeff3;
    }
    input:disabled {
      color: gray;
      background-color: #0000003e;
    }
    input[type=text] {
      width: 30px;
      height: 16px;
      padding: 2px;
      padding-left: 4px;
      font-size: 10px;
      font-family: 'Open Sans', sans-serif;
      border: none;
    }
    input[type=range] {
      appearance: none;
      height: 8px;
    }
    button:hover:enabled {
      background-color: #000000af;
    }
    p {
      margin: 0;
      font-size: 14px;
      font-weight: 400;
    }
    h2 {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .explain-text {
      margin-top: 7px;
    }
    #details {
      font-size: 12px;
      padding: 6px;
      text-size-adjust: none;
      -webkit-text-size-adjust: none;
    }
  </style>
  <script src="main.js" defer></script>
</head>

<body>
  <h1>Pitch shifter / time stretcher</h1>
  <p id="description">Independently changes an audio clip&rsquo;s pitch and tempo by applying the waveform similarity based overlap-add (WSOLA) algorithm.</p>

  <div class="panel">
    <div class="line">
      <div>
        <button id="file-button">Load new audio</button>
        <input type="file" id="file-select" accept="audio/*" style="display: none;">
        <span id="filename"></span>
      </div>
      <button id="load-example">Load example</button>
      <button id="clear" hidden>Reset</button>
    </div>
  </div>

  <div class="panel">
    <div class="line">
      <div>
        <button id="play">Play</button>
        <span id="current-playback">0:00</span>
        <input type="range" name="audio-progress" id="audio-progress"/>
        <span id="playback-length">0:00</span>
      </div>
      <button id="download">Download</button>
    </div>
    <div>
      <canvas id="visualization" width="600px" height="160px"></canvas>
    </div>
    <p id="details">No file selected.</p>
  </div>

  <div class="panel">
    <div class="line">
      <div>
        <div class="slider">
          <p>Pitch shift (semitones)</p>
          <input type="range" class="setting" name="semitones" id="semitones" min="-12" max="12" value="0" step="1"/>
          <input type="text" inputmode="decimal" name="semitones-number" id="semitones-number" value="0"/>
        </div>
        <div class="slider">
          <p>Time multiplier</p>
          <input type="range" class="setting" name="time-stretch" id="time-stretch" min="0.4" max="2.5" value="1" step="0.01"/>
          <input type="text" inputmode="decimal" name="time-stretch-number" id="time-stretch-number" value="1.00"/>
        </div>
      </div>
      <button id="reset-pitch-time" hidden>Reset</button>
    </div>
  </div>

  <div class="panel">
    <div class="line">
      <div>
        <div class="slider">
          <p>Segment length (ms)</p>
          <input type="range" class="setting" name="segment-length" id="segment-length" min="50" max="250" value="100" step="1"/>
          <input type="text" inputmode="numeric" name="segment-length-number" id="segment-length-number" value="100"/>
        </div>
        <div class="slider">
          <p>Segment overlap in output (ms)</p>
          <input type="range" class="setting" name="segment-overlap" id="segment-overlap" min="0" max="40" value="30" step="1"/>
          <input type="text" inputmode="numeric" name="segment-overlap-number" id="segment-overlap-number" value="30"/>
        </div>
        <div class="slider">
          <p>Maximum shift for waveform similarity (ms)</p>
          <input type="range" class="setting" name="max-shift" id="max-shift" min="0" max="15" value="10" step="1"/>
          <input type="text" inputmode="numeric" name="max-shift-number" id="max-shift-number" value="10"/>
        </div>
      </div>
      <button id="reset-settings" hidden>Reset</button>
    </div>
  </div>

  <div id="explanations">
    <h2>How this works</h2>
    <p class="explain-text">Usually, changing the speed of an audio track directly changes its pitch.
      To make digital audio sound 2x faster, for example, software could resample it by skipping every other sample, squeezing what previously took two seconds (88,200 samples) into one second (44,100 samples). 
      The effect is to squish the shape of the audio&rsquo;s waveform in half, doubling its frequency and pushing its pitch one octave higher.</p>
    <p class="explain-text">Images here</p>
    <p class="explain-text">Special techniques are needed to speed up or slow down audio without altering its pitchâ€”or alter its pitch without affecting time. Many of these work in the frequency domain. The idea is to use the Fourier transform to _________ (finish this)</p>
  </div>
</body>

</html>
